/*
 * HLSPlayer.h
 *
 *  Created on: May 5, 2014
 *      Author: Mark
 */

#ifndef HLSPLAYER_H_
#define HLSPLAYER_H_

class HLSPlayer
{
public:
	enum
	{
		STOPPED,
		PAUSED,
		PLAYING,
		SEEKING
	};

	HLSPlayer();
	~HLSPlayer();

	void Close(JNIEnv* env);

	void SetSurface(JNIEnv* env, jobject surface);
	android::status_t FeedSegment(const char* path);

	bool Play();
	int Update();

private:
	void setStatus(int status);
	void SetNativeWindow(ANativeWindow* window);
	bool InitAudio()
	bool CreateAudioPlayer();
	bool CreateVideoPlayer();
	bool RenderBuffer(android::MediaBuffer* buffer);

	int mRenderedFrameCount;
	ANativeWindow* mWindow;

	jobject mSurface;

	int mStatus;

	android::OMXClient mClient;
	android::sp<android::MediaSource> mVideoTrack;
	android::sp<android::MediaSource> mAudioTrack;

	android::sp<android::DataSource> mFileSource;
	android::sp<android::MediaExtractor> mExtractor;

	android::AudioPlayer* mAudioPlayer;
	android::sp<android::MediaPlayerBase::AudioSink> mAudioSink;
	android::TimeSource* mTimeSource;
	bool mOffloadAudio;
	int64_t mDurationUs;

	android::MediaBuffer* mVideoBuffer;

	int64_t mBitrate;
	int32_t mWidth;
	int32_t mHeight;
	int32_t mActiveAudioTrackIndex;
	uint32_t mExtractorFlags;


};



#endif /* HLSPLAYER_H_ */
